{% extends 'base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto pb-24 px-4">

<!-- ================= HEADER ================= -->
<header class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-10 mb-12">

    <div class="flex items-center gap-5">
        <div class="w-14 h-14 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
            <i class="fas fa-file-invoice-dollar text-xl"></i>
        </div>
        <div>
            <h1 class="text-3xl font-black text-slate-900 tracking-tight uppercase">
                Contas a pagar
            </h1>
            <p class="text-[11px] text-slate-500 font-bold uppercase tracking-[3px] mt-1">
                Despesas e obriga√ß√µes financeiras
            </p>
        </div>
    </div>

    <div class="flex items-center gap-4">
        <div class="bg-slate-900 px-7 py-4 rounded-2xl text-right shadow-xl">
            <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">
                Total pendente
            </p>
            <p class="text-xl font-black text-white mt-1">
                R$ <span class="text-primary">{{ total_aberto|floatformat:2 }}</span>
            </p>
        </div>

        <a href="{% url 'despesa_create' %}"
           class="btn bg-primary text-white rounded-2xl px-8 h-14
                  shadow-lg hover:bg-red-900 hover:scale-105 transition
                  font-black uppercase tracking-widest text-xs">
            <i class="fas fa-plus mr-2"></i>
            Nova despesa
        </a>
    </div>
</header>

<!-- ================= FILTROS ================= -->
<div class="bg-white rounded-[2rem] border border-slate-100 shadow-sm p-6 mb-10">
    <form method="get" class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">

        {% for label, name, options in [
            ("Fornecedor","fornecedor",fornecedores),
            ("Categoria","categoria",categorias),
            ("Banco","conta",contas_bancarias)
        ] %}
        <div class="md:col-span-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-1 block">
                {{ label }}
            </label>
            <select name="{{ name }}"
                    class="select select-sm w-full bg-slate-50 border-none rounded-xl font-bold text-xs">
                <option value="">Todos</option>
                {% for o in options %}
                    <option value="{{ o.id }}"
                        {% if filtros[name] == o.id|stringformat:"i" %}selected{% endif %}>
                        {{ o.nome|upper }}
                    </option>
                {% endfor %}
            </select>
        </div>
        {% endfor %}

        <div class="md:col-span-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-1 block">
                In√≠cio
            </label>
            <input type="date" name="inicio"
                   value="{{ filtros.inicio|default:inicio_padrao }}"
                   class="input input-sm w-full bg-slate-50 border-none rounded-xl font-bold text-xs">
        </div>

        <div class="md:col-span-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-1 block">
                Fim
            </label>
            <input type="date" name="fim"
                   value="{{ filtros.fim|default:fim_padrao }}"
                   class="input input-sm w-full bg-slate-50 border-none rounded-xl font-bold text-xs">
        </div>

        <div class="md:col-span-2 flex gap-2">
            <button type="submit"
                    class="btn bg-primary text-white h-10 flex-1 rounded-xl
                           font-black uppercase text-[10px] tracking-widest">
                Filtrar
            </button>
            <a href="{% url 'contas_pagar' %}"
               class="btn btn-square bg-slate-100 h-10 w-10 rounded-xl text-slate-400">
                <i class="fas fa-rotate-left text-xs"></i>
            </a>
        </div>

    </form>
</div>

<!-- ================= TABELA ================= -->
<div class="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden">
    <table class="w-full text-sm">
        <thead class="bg-slate-900 text-white uppercase text-[10px] tracking-widest font-black">
            <tr>
                <th class="py-5 px-6 text-left">Vencimento</th>
                <th class="text-left">Descri√ß√£o</th>
                <th class="text-center">Categoria</th>
                <th class="text-center">Valor</th>
                <th class="text-center">Status</th>
                <th class="text-right px-6">A√ß√µes</th>
            </tr>
        </thead>

        <tbody class="divide-y">
        {% for lanc in lancamentos %}
        <tr class="hover:bg-slate-50 transition">

            <td class="py-5 px-6 font-bold">
                {{ lanc.data_vencimento|date:"d/m/Y" }}
            </td>

            <td>
                <div class="font-black uppercase text-slate-700">
                    {{ lanc.descricao }}
                </div>
                <div class="text-[10px] text-slate-400 uppercase font-bold mt-1">
                    {{ lanc.fornecedor.nome|default:"Fornecedor n√£o informado" }}
                </div>
            </td>

            <td class="text-center">
                <span class="text-[9px] font-black uppercase bg-slate-100 px-3 py-1 rounded-full">
                    {{ lanc.categoria.nome }}
                </span>
            </td>

            <td class="text-center font-black text-primary">
                R$ {{ lanc.valor }}
            </td>

            <td class="text-center">
                {% if lanc.status == 'PAGO' %}
                    <span class="text-[9px] font-black uppercase bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full">
                        Pago
                    </span>
                {% else %}
                    <span class="text-[9px] font-black uppercase bg-orange-100 text-orange-600 px-4 py-1 rounded-full">
                        Pendente
                    </span>
                {% endif %}
            </td>

            <td class="text-right px-6">
                <div class="flex justify-end gap-2">
                    {% if lanc.status == 'PENDENTE' %}
                    <form method="post" action="{% url 'baixar_lancamento' lanc.id %}">
                        {% csrf_token %}
                        <button class="btn btn-square bg-emerald-500 text-white rounded-xl h-9 w-9">
                            <i class="fas fa-check text-xs"></i>
                        </button>
                    </form>
                    {% else %}
                    <form method="post" action="{% url 'estornar_lancamento' lanc.id %}">
                        {% csrf_token %}
                        <button class="btn btn-square bg-slate-100 rounded-xl text-slate-400 h-9 w-9">
                            <i class="fas fa-rotate-left text-xs"></i>
                        </button>
                    </form>
                    {% endif %}
                </div>
            </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="py-20 text-center text-slate-400 font-black uppercase text-xs">
                Nenhuma conta pendente üéâ
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

</div>
{% endblock %}
