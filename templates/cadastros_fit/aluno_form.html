{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}
        Editar Aluno | MayaCorp Fit
    {% else %}
        Sincronizar Aluno | MayaCorp Fit
    {% endif %}
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto pb-24 px-4 sm:px-6">

<!-- ================= HEADER ================= -->
<header class="flex items-start gap-6 mb-12 mt-10">
    <div class="w-14 h-14 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
        <i class="fas fa-user-check text-xl"></i>
    </div>
    <div>
        <h1 class="text-3xl font-black text-slate-900 tracking-tighter uppercase leading-none">
            {% if form.instance.pk %}
                Editar aluno
            {% else %}
                Novo aluno
            {% endif %}
        </h1>
        <p class="text-[11px] text-slate-500 font-bold tracking-widest uppercase mt-2">
            Cadastro mestre • dados oficiais do aluno
        </p>
    </div>
</header>

<!-- ================= CARD ================= -->
<div class="bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200/50 border border-slate-100 overflow-hidden">
<form method="post" enctype="multipart/form-data" id="alunoForm" class="p-10 md:p-16">
{% csrf_token %}

<!-- ================= AUTO PREENCHIMENTO (só no create) ================= -->
{% if not form.instance.pk %}
<section class="bg-slate-50/70 rounded-3xl p-8 mb-16 border border-slate-100">
    <div class="flex flex-col md:flex-row items-center justify-between gap-8">
        <div class="flex items-center gap-5">
            <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center text-slate-400 shadow-sm border border-slate-100">
                <i class="fas fa-wand-magic-sparkles"></i>
            </div>
            <div>
                <p class="text-[11px] font-black text-slate-900 uppercase tracking-widest">
                    Preenchimento inteligente
                </p>
                <p class="text-[10px] text-slate-400 font-medium">
                    Envie documentos para leitura automática
                </p>
            </div>
        </div>
        <div class="flex flex-wrap gap-3">
            <button type="button"
                    class="bg-white border border-slate-200 px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-sm hover:shadow-md transition-all flex items-center"
                    onclick="document.getElementById('input-doc').click()">
                <i class="fas fa-id-card mr-2 text-primary"></i>
                Documento
            </button>
            <button type="button"
                    class="bg-white border border-slate-200 px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-sm hover:shadow-md transition-all flex items-center"
                    onclick="document.getElementById('input-end').click()">
                <i class="fas fa-map-location-dot mr-2 text-secondary"></i>
                Endereço
            </button>
        </div>
        <input type="file" id="input-doc" hidden>
        <input type="file" id="input-end" hidden>
    </div>
    <div class="mt-6 text-[10px] text-slate-400 font-bold uppercase tracking-widest">
        Os dados podem ser revisados antes de salvar
    </div>
</section>
{% endif %}

<!-- ================= DADOS PESSOAIS ================= -->
<section class="space-y-10">
<div class="text-center text-[11px] font-black text-slate-400 uppercase tracking-[4px]">
    Dados pessoais
</div>
<div class="grid grid-cols-1 md:grid-cols-12 gap-x-8 gap-y-12">
    
    <!-- Nome -->
    <div class="md:col-span-8">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Nome completo</label>
        <input type="text" name="{{ form.nome.html_name }}" value="{{ form.nome.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-lg font-bold" 
               {% if form.nome.field.required %}required{% endif %}>
        {% if form.nome.errors %}<div class="text-red-500 text-xs mt-1">{{ form.nome.errors.0 }}</div>{% endif %}
    </div>

    <!-- Data nascimento -->
    <div class="md:col-span-4">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Data nascimento</label>
        <input type="date" name="{{ form.data_nascimento.html_name }}" value="{{ form.data_nascimento.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.data_nascimento.field.required %}required{% endif %}>
        {% if form.data_nascimento.errors %}<div class="text-red-500 text-xs mt-1">{{ form.data_nascimento.errors.0 }}</div>{% endif %}
    </div>

    <!-- CPF -->
    <div class="md:col-span-6">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">CPF</label>
        <input type="text" name="{{ form.cpf.html_name }}" value="{{ form.cpf.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.cpf.field.required %}required{% endif %}>
        {% if form.cpf.errors %}<div class="text-red-500 text-xs mt-1">{{ form.cpf.errors.0 }}</div>{% endif %}
    </div>

    <!-- Telefone -->
    <div class="md:col-span-6">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Telefone/WhatsApp</label>
        <input type="tel" name="{{ form.telefone.html_name }}" value="{{ form.telefone.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.telefone.field.required %}required{% endif %}>
        {% if form.telefone.errors %}<div class="text-red-500 text-xs mt-1">{{ form.telefone.errors.0 }}</div>{% endif %}
    </div>

    <!-- Email -->
    <div class="md:col-span-12">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">E-mail</label>
        <input type="email" name="{{ form.email.html_name }}" value="{{ form.email.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.email.field.required %}required{% endif %}>
        {% if form.email.errors %}<div class="text-red-500 text-xs mt-1">{{ form.email.errors.0 }}</div>{% endif %}
    </div>
</div>
</section>

<!-- ================= ENDEREÇO ================= -->
<section class="space-y-10 mt-16">
<div class="text-center text-[11px] font-black text-slate-400 uppercase tracking-[4px]">
    Endereço & localização
</div>

<!-- LINHA 1: Logradouro GRANDE + Número -->
<div class="grid grid-cols-1 md:grid-cols-12 gap-x-6 gap-y-6">
    <!-- Logradouro (75% da largura) -->
    <div class="md:col-span-9">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Logradouro</label>
        <input type="text" name="{{ form.logradouro.html_name }}" value="{{ form.logradouro.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.logradouro.field.required %}required{% endif %}>
        {% if form.logradouro.errors %}<div class="text-red-500 text-xs mt-1">{{ form.logradouro.errors.0 }}</div>{% endif %}
    </div>
    <!-- Número -->
    <div class="md:col-span-3">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Número</label>
        <input type="text" name="{{ form.numero.html_name }}" value="{{ form.numero.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.numero.field.required %}required{% endif %}>
        {% if form.numero.errors %}<div class="text-red-500 text-xs mt-1">{{ form.numero.errors.0 }}</div>{% endif %}
    </div>
</div>

<!-- LINHA 2: CEP + Bairro + Cidade -->
<div class="grid grid-cols-1 md:grid-cols-12 gap-x-6 gap-y-6">
    <div class="md:col-span-3">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">CEP</label>
        <input type="text" name="{{ form.cep.html_name }}" value="{{ form.cep.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.cep.field.required %}required{% endif %}>
        {% if form.cep.errors %}<div class="text-red-500 text-xs mt-1">{{ form.cep.errors.0 }}</div>{% endif %}
    </div>
    <div class="md:col-span-5">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Bairro</label>
        <input type="text" name="{{ form.bairro.html_name }}" value="{{ form.bairro.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.bairro.field.required %}required{% endif %}>
        {% if form.bairro.errors %}<div class="text-red-500 text-xs mt-1">{{ form.bairro.errors.0 }}</div>{% endif %}
    </div>
    <div class="md:col-span-4">
        <label class="block text-[11px] font-black text-slate-900 uppercase tracking-[2px] mb-2">Cidade</label>
        <input type="text" name="{{ form.cidade.html_name }}" value="{{ form.cidade.value|default:'' }}" 
               class="w-full h-14 px-5 rounded-2xl border border-slate-200 bg-white shadow-sm focus:ring-2 focus:ring-primary focus:border-primary font-bold" 
               {% if form.cidade.field.required %}required{% endif %}>
        {% if form.cidade.errors %}<div class="text-red-500 text-xs mt-1">{{ form.cidade.errors.0 }}</div>{% endif %}
    </div>
</div>
</section>

<!-- ================= ALERTA ================= -->
<div class="mt-16 bg-amber-50 border border-amber-200 rounded-2xl p-6 flex items-center gap-4">
    <i class="fas fa-circle-info text-amber-500"></i>
    <p class="text-[11px] font-black uppercase tracking-widest text-amber-900">
        Confira os dados antes de salvar. Essas informações impactam contratos e cobranças.
    </p>
</div>

<!-- ================= AÇÕES ================= -->
<div class="mt-20 pt-10 border-t border-slate-100 flex flex-col md:flex-row items-center justify-between gap-6">
    <a href="{% url 'aluno_list' %}"
       class="text-slate-400 hover:text-slate-600 bg-white border border-slate-200 px-8 py-3 rounded-2xl font-black text-[11px] tracking-[2px] uppercase shadow-sm hover:shadow-md transition-all">
        Cancelar
    </a>
    <button type="submit"
            class="bg-primary text-white px-14 h-16 rounded-2xl font-black text-[12px] tracking-[3px] uppercase shadow-xl shadow-primary/30 hover:scale-[1.02] transition-all">
        Salvar
    </button>
</div>

</form>
</div>
</div>

<!-- NON FIELD ERRORS -->
{% if form.non_field_errors %}
<div class="mt-4 p-4 bg-red-50 border border-red-200 rounded-2xl max-w-4xl mx-auto">
    {% for error in form.non_field_errors %}
    <div class="text-red-600 text-sm font-bold">{{ error }}</div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
